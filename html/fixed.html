<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <link rel="stylesheet" type="text/css" href="../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../css/aui.css"/>
    <style>
        html, body {
            /*background-color: #dfdede !important;*/
            background: -webkit-linear-gradient(top, #4fbcf4, #32cabe);
        }

        nav {
            height: 100%;
            position: relative;
        }

        i.aui-iconfont {
            font-size: 24px;
            color: #ffffff;
        }

        #account {
            display: -webkit-box;
            color: #FFFFFF;
            height: 260px;
            width: 260px;
            background-color: #2da1da;
            position: relative;
            margin-bottom: 10px;
        }

        #scanner{
            position: absolute;
            right: 10%;
            top: 10%;
            display: inline-block;
        }
        #scanner i.aui-iconfont{
            font-size: 30px;
        }

        #nickname {
            position: absolute;
            left: 0;
            bottom: 0;
            width: 100%;
            line-height: 80px;
            font-size: 22px;
            text-align: center;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        #head-img {
            position: absolute;
            left: 50%;
            top: 50%;
            margin-left: -65px;
            margin-top: -91px;
            height: 130px;
            width: 130px;
        }

        #head-img img {
            height: 100%;
            width: 100%;
            border: 8px solid #88caec;
            border-radius: 400px;
        }

        ul.mainCell {
            width: 100%;
            padding: 0 4px;
        }

        ul.mainCell li {
            width: 33%;
            height: 86px;
            position: relative;
            float: left;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-right-color: rgba(0, 0, 0, 0.1);
            border-bottom-color: rgba(0, 0, 0, 0.1);
            display: -webkit-box;
            -webkit-box-align: center;
            text-align: center;
        }

        ul.mainCell li:nth-child(1), ul.mainCell li:nth-child(4), ul.mainCell li:nth-child(7) {
            border-left: 0;
        }

        ul.mainCell li:nth-child(3), ul.mainCell li:nth-child(6), ul.mainCell li:nth-child(9) {
            border-right: 0;
        }

        ul.mainCell li div {
            display: -webkit-box;
            -webkit-box-orient: vertical;
            margin: 0 auto;
        }

        ul.mainCell li div a {
            display: block;
            color: #FFFFFF;
        }

        ul.bottomCell {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: auto;
            padding-bottom: 6px;
        }

        ul.bottomCell li {
            width: 50%;
            height: 40px;
            float: left;
            display: -webkit-box;
            -webkit-box-align: center;
        }

        ul.bottomCell li:first-child {
            border-right: 1px solid rgba(0, 0, 0, 0.1);
        }

        ul.bottomCell li div {
            margin: 0 auto;
        }

        ul.bottomCell li div a {
            color: #FFFFFF;
        }

        .liActive {
            background-color: rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
<nav>
    <div id="account">
        <div id="head-img" onclick="ShowProfile();"><img src="../image/default_head.jpg"/></div>
        <div id="nickname">游客</div>
        <div style="height: 10px;width: 100%;background-color: #33abdd;position: absolute;bottom: -10px;"></div>
        <div id="scanner" onclick="OpenScanner();">
            <i class="aui-iconfont aui-icon-scan"></i>
        </div>
    </div>
    <ul class="mainCell">
        <li tapmode="liActive" onclick="OpenWin('home.html');">
            <div><i class="aui-iconfont aui-icon-home"></i><a>首页</a></div>
        </li>
        <li tapmode="liActive" onclick="OpenWin('answer.html');">
            <div><i class="aui-iconfont aui-icon-edit"></i><a>答题</a></div>
        </li>
        <li tapmode="liActive" onclick="OpenWin('document.html');">
            <div><i class="aui-iconfont aui-icon-file"></i><a>资料</a></div>
        </li>
        <li tapmode="liActive" onclick="ShowProfile();">
            <div><i class="aui-iconfont aui-icon-profile"></i><a>个人</a></div>
        </li>
        <li tapmode="liActive" onclick="OpenWin('rank.html');">
            <div><i class="aui-iconfont aui-icon-rank"></i><a>排名</a></div>
        </li>
        <li tapmode="liActive" onclick="OpenWin('entertaining.html');">
            <div><i class="aui-iconfont aui-icon-game"></i><a>娱乐</a></div>
        </li>
    </ul>
    <ul class="bottomCell">
        <li tapmode="liActive" onclick="OpenWin('more.html')">
            <div><i class="aui-iconfont aui-icon-more"></i><a>更多</a></div>
        </li>
        <li tapmode="liActive" onclick="OpenWin('setting.html')">
            <div><i class="aui-iconfont aui-icon-settings"></i><a>设置</a></div>
        </li>
    </ul>
</nav>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/mrg.js"></script>
<script>
    apiready = function () {
        //动态适配UI
        var $nav = $api.dom('nav');
        $api.fixStatusBar($nav);
        var navWidth = api.winWidth - 60;
        $api.css($nav, 'width:' + navWidth + 'px;');
        var $account = $api.dom('#account');
        $api.css($account, 'height:' + navWidth + 'px;width:' + navWidth + 'px;background-color:#2da1da;');
        var $imgContainer = $api.dom('#head-img');
        var imgWidth = navWidth * 0.5;
        $api.css($imgContainer, 'height:' + imgWidth + 'px;width:' + imgWidth + 'px;margin-left:-' + imgWidth * 0.5 + 'px;margin-top:-' + imgWidth * 0.7 + 'px;');
        var $listItem = $api.domAll('ul li');
        for (var i = 0; i < $listItem.length; i++) {
            $api.css($listItem[i], 'height:' + $api.cssVal($listItem, 'width'));
        }
    };

    //变更窗口
    function OpenWin(url) {
        api.closeSlidPane();

        var $script = "ChangeWin('" + url + "');";
        api.execScript({
            name: "slide",
            script: $script
        });
    }

    //更新头像与昵称
    function UpdateAvatar() {
        var userInfo = $api.getStorage('userInfo');
        var $img = $api.dom('#head-img img');
        var $nickname = $api.dom('#nickname');
        if (userInfo) {
            //更新头像
            if (userInfo.avatar) {
                $api.attr($img, 'src', userInfo.avatar.url);
            }
            else {
                $api.attr($img, 'src', '../image/default_head.jpg');
            }
            //更新昵称
            if (userInfo.nickname) {
                $api.html($nickname, userInfo.nickname);
            }
            else {
                $api.html($nickname, '游客');
            }
        }else{
            //没有信息
            $api.attr($img, 'src', '../image/default_head.jpg');
            $api.html($nickname, '游客');
        }
    }

    function ShowProfile() {
        var userInfo = $api.getStorage('userInfo');
        if (!userInfo) {
            OpenWin('login.html')
        } else {
            OpenWin('profile.html');
        }
    }

    UpdateAvatar();//一开始就更新一次头像
</script>
</html>